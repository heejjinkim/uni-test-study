## 리팩토링할 코드 식별하기

### 코드 분류 유형
1. 복잡도 와 도메인 유의성
	- 복잡도 : 코드 내 의사결정 지점 수    
	- 도메인 유의성 : 도메인에 대해 얼마나 의미 있는지       
	  일반적인 도메인 계층의 모든 코드 <---> 유틸리티 코드     
	- 이 둘은 서로 독립적     
		- 도메인 코드는 복잡할 필요 없으며, 복잡한 코드는 도메인 유의성을 나타내지 않아도 된다.    
2. 협력자 수      
	- 가변 의존성 / 프로세스 외부 의존성      
	- 협력자 수가 많아지면 테스트가 커진다      

### 코드의 유형

1. 도메인 모델과 알고리즘
	- 테스트 코드가 매우 가치있고, 테스트 코드 작성 비용이 낮음
	- 외부 의존성을 사용하면 안됨
3. 지나치게 복잡한 코드
	- 이 부분을 리팩토링 진행해야 함
3. 컨트롤러
	- 포괄적인 통합 테스트의 일부로서 간단히 테스트해야 함
4. 간단한 코드
	- 테스트할 필요가 없음

![image](https://github.com/user-attachments/assets/0727adb2-a24f-4121-a274-acc1d5390c2c)

### 지나치게 복잡한 코드 분리 : Humble Object

테스트하기 쉽도록 분리해야 함      
```
지나치게 복잡한 코드 => 알고리즘 + 컨트롤러
```



지나치게 복잡한 코드 내부에서 아래 두 가지로 나눠, Humber Wrapper 로 감싼다.
- 테스트하기 쉬운 코드 : 로직
- 테스트하기 어려운 코드 : 복잡하거나 높은 의존성

이후, 로직을 테스트하는 방식      

|                AS-IS                 |                TO-BE                 |
| :----------------------------------: | :----------------------------------: |
| ![image](https://github.com/user-attachments/assets/396f88e7-1fe2-47f8-b818-3cc515e6f161) | ![image](https://github.com/user-attachments/assets/e3855c98-90bd-43ea-a208-600cdc230406) |


함수형 아키텍쳐와 육각형 아키텍쳐와 유사한 방식      
![image](https://github.com/user-attachments/assets/d04dbf61-5e6f-498e-962e-6c3e332028d3)

### 코드는 깊거나 넓거나
결국, 코드를 깊이와 너비를 분리해야 한다.      
코드가 깊거나 넓을 수 있지만, 둘 다 가능하지 않다는 점 => SRP      
ex) MVP, MVC      

## 가치 있는 단위 테스트를 위한 리팩토링
https://github.com/eun-seong/unit-testing-crm-example

