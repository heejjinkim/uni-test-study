## 1 단위 테스트를 구성하는 방법


### 1.1 AAA 패턴 사용


AAA패턴은 각 테스트를 준비, 실행, 검증이라는 세 부분으로 나눌 수 있다.

AAA패턴은 스위트 내 모든 테스트가 단순하고 균일한 구조를 갖는데 도움이 된다.

이러한 일관성 덕분에 익숙해지면 모든 테스트를 쉽게 읽을 수 있고 이해할 수 있다. 결국 전체 테스트 스위트의 유지 보수 비용이 줄어든다.

구조는 다음과 같다.


- 준비 구절에서는 테스트 대상 시스템(SUT)과 해당 의존성을 원하는 상태로 만든다.
- 실행 구절에서는 SUT에서 메서드를 호출하고 준비된 의존성을 전달하며 출력 값을 캡처한다.
- 검증 구절에서는 결과를 검증한다. 결과는 반환 값이나 SUT와 협력자의 최종 상태, SUT가 협력자에 호출한 메서드 등으로 표시될 수 있다.

### 1.2 여러 개의 준비, 실행, 검증 구절 피하기


때로는 준비, 실행, 또는 검증 구절이 여러 개 있는 테스트를 만날 수 있다. 보통 다음과 같이 나타난다.

테스트 준비 → 실행 → 검증 → 좀 더 실행 → 다시 검증

이러한 구조는 피하는 것이 좋다. 실행이 하나면 테스트가 단위 테스트 범주에 있게끔 보장하고, 간단하고, 빠르며, 이해하기 쉽다. 일련의 실행과 검증이 포함된 테스트를 보면 리팩터링하라. 각 동장을 고유의 테스트로 도출하라.

### 1.3 테스트 내 if문 피하기


if문은 테스트가 한 번에 너무 많은 것을 검증한다는 표시다. 그러므로 이러한 테스트는 반드시 여러 테스트로 나눠야 한다. 여러 AAA구절과 달리, 통합 테스트에도 예외는 없다.

테스트에 분기가 있어서 얻는 이점은 없다. 단지 추가 유지비만 불어난다. if문은 테스트를 읽고 이해하는 것을 더 어렵게 만든다.

### 1.4 각 구절은 얼마나 커야 하는가?


[준비 구절이 큰 경우]

일반적으로 준비 구절이 세 구절 중 가장 크며, 실행과 검증을 합친 만큼 클 수도 있다. 그러나 이보다 훨씬 크면, 같은 테스트 클래스 내 비공개 메서드 또는 별도의 팩토리 클래스로 도출하는 것이 좋다.

준비 구절에서 코드 재사용에 도움이 되는 두 가지 패턴으로 오브젝트 마더와 테스트 데이터 빌더가 있다.

[실행 구절이 한 줄 이상인 경우를 경계해라]

실행 구절은 보통 코드 한 줄이다. 실행 구절이 두 줄 이상인 경우 SUT의 공개 API에 문제가 있을 수 있다.

### 1.5 검증 구절에는 검증문이 얼마나 있어야 하는가


단위 테스트의 단위는 동작의 단위이다. 단일 동작 단위는 여러 결과를 낼 수 있으며, 하나의 테스트로 그 모든 결과를 평가하는 것이 좋다.

그렇기는 해도 검증 구절이 너무 커지는 것은 경계해야 한다. 제품 코드에서 추상화가 누락됐을 수 있다.

예를들어 SUT에서 반환된 객체 내에서 모든 속성을 검증하는 대신 객체 클래스 내에 적절한 동등 멤버를 정의하는 것이 좋다. 그러면 단일 검증문으로 객체를 기대값과 비교할 수 있다.

### 1.6 종료 단계는 어떤가


준비, 실행, 검증 이후에 네 번째 구절로 종료 구절을 따로 구분하기도 한다.


- 테스트에 의해 작성된 파일을 지우거나
- 데이터베이스 연결을 종료하고자 하거나

종료는 일반적으로 별도의 메서드로 도출돼, 클래스 내 모든 테스트에서 재사용된다. AAA패턴에는 이 단계를 포함하지 않는다.

### 1.7 테스트 대상 시스템 구별하기


SUT는 테스트에서 중요한 역할을 하는데, 애플리케이션에서 호출하고자 하는 동작에 대한 진입점을 제공한다.

동작은 여러 클래스에 걸쳐 있을 만큼 클 수도 있고 단일 메서등로 작을 수 있다. 그러나 진입점은 오직 하나만 존재할 수 있다.

따라서 SUT를 의존성과 구분하는 것이 중요하다. 그렇게 하기 위해 테스트 내 SUT 이름을 sut로 하라.

### 1.8 준비, 실행, 검증 주석 제거하기


테스트 내에서 특정 부분이 어떤 구절에 속해 있는지 파악하는 데 시간을 많이 들이지 않도록 세 구절을 서로 구분한는 것 역기 중요하다.

이를 위한 한 가지 방법은 각 구절을 시작하기 전에 주석을 다는 것이다. 다른 방법은 빈 줄로 분리하는 것이다.

빈줄로 구분하는것은 대규모 테스트에서는 잘 작동하지 않는다. 대규모 테스트에서는 준비 단계에 빈 줄을 추가해 설정 단계를 구분할 수도 있다.


- AAA 패턴을 따르고 준비 및 검증 구절에 빈 줄을 추가하지 않아도 되는 테스트라면 구절 주석들을 제거하라
- 그렇지 않으면 구절 주석을 유지하라
